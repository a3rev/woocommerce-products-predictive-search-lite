jQuery(document).ready(function(s){var e=wc_ps_vars.legacy_api_url,t=(wc_ps_vars.permalink_structure,wc_ps_vars.search_page_url,wc_ps_vars.minChars),i=wc_ps_vars.delay,a=24,c=!0,n=!0,r="fadeInUpBig";void 0!==wc_ps_vars.cache_timeout&&(a=wc_ps_vars.cache_timeout),void 0!==wc_ps_vars.is_debug&&"yes"!=wc_ps_vars.is_debug&&(c=!1),void 0!==wc_ps_vars.allow_result_effect&&"yes"!=wc_ps_vars.allow_result_effect&&(n=!1),void 0!==wc_ps_vars.show_effect&&(r=wc_ps_vars.show_effect),c&&console.log("Predictive Search -- DEBUG");var o={apps:{},models:{},collections:{},views:{}};_.templateSettings={evaluate:/[<{][%{](.+?)[%}][}>]/g,interpolate:/[<{][%{]=(.+?)[%}][}>]/g,escape:/[<{][%{]-(.+?)[%}][}>]/g},o.models.Item=Backbone.Model.extend({defaults:{title:"Empty Product",keyword:"",url:null,image_url:null,sku:null,price:null,description:null,stock:null,categories:[],type:"product",status:!0}}),o.collections.Items=Backbone.Collection.extend({model:o.models.Item,totalItems:function(){return this.where({status:!0}).length},haveItems:function(e){return this.where({type:e}).length}}),o.views.Item=Backbone.View.extend({tagName:"li",className:function(e){switch(this.model.get("type")){case"nothing":return"ac_odd nothing";default:return"ac_odd"}},itemTpl:_.template(s("#wc_psearch_itemTpl").html().replace("/*<![CDATA[*/","").replace("/*]]>*/","")),footerSidebarTpl:_.template(s("#wc_psearch_footerSidebarTpl").html().replace("/*<![CDATA[*/","").replace("/*]]>*/","")),footerHeaderTpl:_.template(s("#wc_psearch_footerHeaderTpl").html().replace("/*<![CDATA[*/","").replace("/*]]>*/","")),initialize:function(){this.listenTo(this.model,"destroy",this.remove)},render:function(){switch(this.model.get("type")){case"header":this.$el.html('<div class="ajax_search_content_title">'+this.model.get("title")+"</div>");break;case"footerSidebar":this.$el.html(this.footerSidebarTpl(this.model.toJSON()));break;case"footerHeader":this.$el.html(this.footerHeaderTpl(this.model.toJSON()));break;case"nothing":this.$el.html('<div class="ajax_no_result">'+this.model.get("title")+"</div>");break;default:n?this.$el.html(this.itemTpl(this.model.toJSON())).addClass("animated "+r).one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){s(this).removeClass("animated "+r)}):this.$el.html(this.itemTpl(this.model.toJSON()))}return this}}),o.views.PopupResult=Backbone.View.extend({initialize:function(){this.predictive_search_input=null,this.original_ps_search_other="",this.delaytime=0,this.prepend=!1,this.listenTo(this.collection,"add",this.addItem),this.list_items_container=this.$(".predictive_search_results")},createItems:function(e,t){this.prepend=t,s.each(e,function(e,t){this.collection.add(t)}.bind(this)),""==this.original_ps_search_other&&(this.original_ps_search_other=s(this.predictive_search_input).data("ps-search_other")),""==this.original_ps_search_in&&(this.original_ps_search_in=s(this.predictive_search_input).data("ps-search_in")),ps_search_other=this.original_ps_search_other.split(","),ps_id=s(this.predictive_search_input).data("ps-id"),new_ps_search_other=[],new_ps_search_in="",s.each(ps_search_other,function(e,t){0<this.collection.haveItems(t)&&(new_ps_search_other.push(t),""==new_ps_search_in&&(new_ps_search_in=t))}.bind(this)),""!=new_ps_search_in&&(s(this.predictive_search_input).data("ps-search_in",new_ps_search_in),s("#wc_ps_form_"+ps_id).find("input[name=search_in]").val(new_ps_search_in)),0==new_ps_search_other.length&&(new_ps_search_other=[s(this.predictive_search_input).data("ps-search_in")]),s(this.predictive_search_input).data("ps-search_other",new_ps_search_other.join(",")),s("#wc_ps_form_"+ps_id).find("input[name=search_other]").val(new_ps_search_other.join(","))},addItem:function(e){var t=new o.views.Item({model:e}).render().el;this.prepend?this.list_items_container.prepend(t):this.list_items_container.append(t),s.data(t,"ac_data",e.attributes)},clearAll:function(){return _.invoke(this.collection.where({status:!0}),"destroy"),!1}}),o.apps.App={initialize:function(){s(document).on("click",".wc_ps_nav_submit_bt",this.goToSearchResultPage),s(".wc_ps_form").bind("keypress",function(e){if(13==e.keyCode)return this.goToSearchResultPage(e),!1}.bind(this)),s(".wc_ps_category_selector").change(function(){s(this).parents(".wc_ps_container").find(".wc_ps_nav_facade_label").html(s(this).find("option:selected").text().trim())}).focus(function(){s(this).parents(".wc_ps_container").addClass("wc_ps_container_active")}).blur(function(){s(this).parents(".wc_ps_container").removeClass("wc_ps_container_active")}),s(document).on("click",".wc_ps_mobile_icon",function(){var e=s(this).data("ps-id"),t=s(this).offset().top+s(this).outerHeight()+8;s(this).hasClass("active")?(s(this).removeClass("active"),s(this).parents(".wc_ps_bar").append(s("#wc_ps_container_"+e)).append('<div style="clear:both;"></div>'),s("#wc_ps_mobile_popup_"+e).remove()):(s(this).addClass("active"),s('<div class="wc_ps_mobile_popup" id="wc_ps_mobile_popup_'+e+'"></div>').appendTo(document.body),s(this).parents(".wc_ps_bar").find(".wc_ps_container").appendTo(s("#wc_ps_mobile_popup_"+e)),s("#wc_ps_mobile_popup_"+e).css({transform:"translate3d(20px, "+t+"px, 0)"})),s(".ac_input_"+e).trigger("ps_mobile_icon_click")}),this.initPredictSearch()},initPredictSearch:function(){s(".wc_ps_search_keyword").each(function(){s(this).ps_autocomplete(e,{minChars:t,delay:i,cacheTimeout:a,isDebug:c,scrollHeight:2e3,loadingClass:"predictive_loading",highlight:!1},o),s(this).result(function(e,t,i){""!=t&&s(this).val(t),""!=i&&null!=i&&"#"!=i&&(window.location=i)})}).focus(function(){s(this).parents(".wc_ps_container").addClass("wc_ps_container_active")}).blur(function(){s(this).parents(".wc_ps_container").removeClass("wc_ps_container_active")})},goToSearchResultPage:function(e){var t=s(e.target);ps_id=t.data("ps-id"),predictive_search_input=s("#wc_ps_search_keyword_"+ps_id),cat_selected=predictive_search_input.parents(".wc_ps_container").find(".wc_ps_category_selector option:selected"),""!=predictive_search_input.val()&&predictive_search_input.val()!=predictive_search_input.data("ps-default_text")?s("#wc_ps_form_"+ps_id).submit():""!==cat_selected.val()&&(cat_href=cat_selected.data("href"),window.location=cat_href)}},o.apps.App.initialize()});