jQuery(document).ready(function(a){var b=wc_ps_vars.legacy_api_url,e=(wc_ps_vars.permalink_structure,wc_ps_vars.search_page_url,wc_ps_vars.minChars),f=wc_ps_vars.delay,g=24,h=!0,i=!0,j="fadeInUpBig";void 0!==wc_ps_vars.cache_timeout&&(g=wc_ps_vars.cache_timeout),void 0!==wc_ps_vars.is_debug&&"yes"!=wc_ps_vars.is_debug&&(h=!1),void 0!==wc_ps_vars.allow_result_effect&&"yes"!=wc_ps_vars.allow_result_effect&&(i=!1),void 0!==wc_ps_vars.show_effect&&(j=wc_ps_vars.show_effect),h&&console.log("Predictive Search -- DEBUG");var k={apps:{},models:{},collections:{},views:{}};_.templateSettings={evaluate:/[<{][%{](.+?)[%}][}>]/g,interpolate:/[<{][%{]=(.+?)[%}][}>]/g,escape:/[<{][%{]-(.+?)[%}][}>]/g},k.models.Item=Backbone.Model.extend({defaults:{title:"Empty Product",keyword:"",url:null,image_url:null,sku:null,price:null,description:null,stock:null,categories:[],type:"product",status:!0}}),k.collections.Items=Backbone.Collection.extend({model:k.models.Item,totalItems:function(){return this.where({status:!0}).length},haveItems:function(a){return this.where({type:a}).length}}),k.views.Item=Backbone.View.extend({tagName:"li",className:function(a){switch(this.model.get("type")){case"nothing":return"ac_odd nothing";default:return"ac_odd"}},itemTpl:_.template(a("#wc_psearch_itemTpl").html().replace("/*<![CDATA[*/","").replace("/*]]>*/","")),footerSidebarTpl:_.template(a("#wc_psearch_footerSidebarTpl").html().replace("/*<![CDATA[*/","").replace("/*]]>*/","")),footerHeaderTpl:_.template(a("#wc_psearch_footerHeaderTpl").html().replace("/*<![CDATA[*/","").replace("/*]]>*/","")),initialize:function(){this.listenTo(this.model,"destroy",this.remove)},render:function(){switch(this.model.get("type")){case"header":this.$el.html('<div class="ajax_search_content_title">'+this.model.get("title")+"</div>");break;case"footerSidebar":this.$el.html(this.footerSidebarTpl(this.model.toJSON()));break;case"footerHeader":this.$el.html(this.footerHeaderTpl(this.model.toJSON()));break;case"nothing":this.$el.html('<div class="ajax_no_result">'+this.model.get("title")+"</div>");break;default:i?this.$el.html(this.itemTpl(this.model.toJSON())).addClass("animated "+j).one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){a(this).removeClass("animated "+j)}):this.$el.html(this.itemTpl(this.model.toJSON()))}return this}}),k.views.PopupResult=Backbone.View.extend({initialize:function(){this.predictive_search_input=null,this.original_ps_search_other="",this.delaytime=0,this.prepend=!1,this.listenTo(this.collection,"add",this.addItem),this.list_items_container=this.$(".predictive_search_results")},createItems:function(b,c){this.prepend=c,a.each(b,function(a,b){this.collection.add(b)}.bind(this)),""==this.original_ps_search_other&&(this.original_ps_search_other=a(this.predictive_search_input).data("ps-search_other")),""==this.original_ps_search_in&&(this.original_ps_search_in=a(this.predictive_search_input).data("ps-search_in")),ps_search_other=this.original_ps_search_other.split(","),ps_id=a(this.predictive_search_input).data("ps-id"),new_ps_search_other=[],new_ps_search_in="",a.each(ps_search_other,function(a,b){this.collection.haveItems(b)>0&&(new_ps_search_other.push(b),""==new_ps_search_in&&(new_ps_search_in=b))}.bind(this)),""!=new_ps_search_in&&(a(this.predictive_search_input).data("ps-search_in",new_ps_search_in),a("#wc_ps_form_"+ps_id).find("input[name=search_in]").val(new_ps_search_in)),0==new_ps_search_other.length&&(new_ps_search_other=[a(this.predictive_search_input).data("ps-search_in")]),a(this.predictive_search_input).data("ps-search_other",new_ps_search_other.join(",")),a("#wc_ps_form_"+ps_id).find("input[name=search_other]").val(new_ps_search_other.join(","))},addItem:function(b){var c=new k.views.Item({model:b}),d=c.render().el;this.prepend?this.list_items_container.prepend(d):this.list_items_container.append(d),a.data(d,"ac_data",b.attributes)},clearAll:function(){return _.invoke(this.collection.where({status:!0}),"destroy"),!1}}),k.apps.App={initialize:function(){a(document).on("click",".wc_ps_nav_submit_bt",this.goToSearchResultPage),a(".wc_ps_form").bind("keypress",function(a){if(13==a.keyCode)return this.goToSearchResultPage(a),!1}.bind(this)),a(".wc_ps_category_selector").change(function(){a(this).parents(".wc_ps_container").find(".wc_ps_nav_facade_label").html(a(this).find("option:selected").text().trim())}).focus(function(){a(this).parents(".wc_ps_container").addClass("wc_ps_container_active")}).blur(function(){a(this).parents(".wc_ps_container").removeClass("wc_ps_container_active")}),this.initPredictSearch()},initPredictSearch:function(){a(".wc_ps_search_keyword").each(function(){a(this).ps_autocomplete(b,{minChars:e,delay:f,cacheTimeout:g,isDebug:h,scrollHeight:2e3,loadingClass:"predictive_loading",highlight:!1},k),a(this).result(function(b,c,d){""!=c&&a(this).val(c),""!=d&&null!=d&&"#"!=d&&(window.location=d)})}).focus(function(){a(this).parents(".wc_ps_container").addClass("wc_ps_container_active")}).blur(function(){a(this).parents(".wc_ps_container").removeClass("wc_ps_container_active")})},goToSearchResultPage:function(b){var c=a(b.target);ps_id=c.data("ps-id"),predictive_search_input=a("#wc_ps_search_keyword_"+ps_id),cat_selected=predictive_search_input.parents(".wc_ps_container").find(".wc_ps_category_selector option:selected"),""!=predictive_search_input.val()&&predictive_search_input.val()!=predictive_search_input.data("ps-default_text")?a("#wc_ps_form_"+ps_id).submit():""!==cat_selected.val()&&(cat_href=cat_selected.data("href"),window.location=cat_href)}},k.apps.App.initialize()});