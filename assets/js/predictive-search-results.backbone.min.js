(function(a){a(function(){var b=wc_ps_results_vars.legacy_api_url,c=wc_ps_results_vars.permalink_structure,d={apps:{},models:{},collections:{},views:{}};_.templateSettings={evaluate:/[<{][%{](.+?)[%}][}>]/g,interpolate:/[<{][%{]=(.+?)[%}][}>]/g,escape:/[<{][%{]-(.+?)[%}][}>]/g},d.models.Item=Backbone.Model.extend({defaults:{title:"Empty Product",url:null,image_url:null,sku:null,price:null,description:null,addtocart:null,stock:null,categories:[],tags:[],type:"product",status:!0,card:""}}),d.collections.Items=Backbone.Collection.extend({model:d.models.Item}),d.views.Item=Backbone.View.extend({tagName:"div",className:"rs_result_row",template:_.template(a("#wc_psearch_result_itemTpl").html().replace("/*<![CDATA[*/","").replace("/*]]>*/","")),initialize:function(){this.listenTo(this.model,"destroy",this.remove)},render:function(){return""===this.model.get("card")?this.$el.html(this.template(this.model.toJSON())):this.setElement(this.model.get("card")),this}}),d.views.ResultContainer=Backbone.View.extend({cached:{},addCache:function(a,b,c,d){this.cached[a+"-"+b+"-"+c]=d},flushCached:function(){this.cached={}},events:{"click .ps_navigation":"initRouter"},initRouter:function(b){b.preventDefault();var c=a(b.target),d=c.data("href");Backbone.history.navigate(d,{trigger:!0})},footerTpl:_.template(a("#wc_psearch_result_footerTpl").html().replace("/*<![CDATA[*/","").replace("/*]]>*/","")),initialize:function(){this.total_items=0,this.search_in=wc_ps_results_vars.search_in,this.ps_lang=wc_ps_results_vars.ps_lang,this.next_page_number=1,this.is_first_load=!0,this.listenTo(this.collection,"add",this.addItem),this.list_items_container=this.$("#ps_list_items_container"),this.footer=this.$("#ps_footer_container"),this.ps_more_check=this.$("#ps_more_check"),this.ps_more_result_popup=this.$("#ps_more_result_popup"),this.ps_no_more_result_popup=this.$("#ps_no_more_result_popup"),this.ps_fetching_result_popup=this.$("#ps_fetching_result_popup"),this.ps_no_result_popup=this.$("#ps_no_result_popup"),this.endless_loading=!1,a(window).on('scroll',function(){1<this.next_page_number&&this.endlessScrollLoad()}.bind(this))},render:function(){return this.footer.html(this.footerTpl({next_page_number:this.next_page_number,first_load:this.is_first_load,total_items:this.total_items})),this},addItem:function(a){var b=new d.views.Item({model:a});""!==a.get("card")&&"grid"===wc_ps_results_vars.display_type?1>this.list_items_container.find(wc_ps_results_vars.grid_container_class).length?this.list_items_container.append(b.render().el):this.list_items_container.find(wc_ps_results_vars.grid_container_class).append(b.render().el):(this.list_items_container.append(b.render().el),this.list_items_container.append("<div style=\"clear:both\"></div>"))},clearAll:function(){return _.invoke(this.collection.where({status:!0}),"destroy"),!1},checkDisplayGrid:function(){-1===a.inArray(this.search_in,["post","page"])?"grid"===wc_ps_results_vars.display_type&&1>this.list_items_container.find(wc_ps_results_vars.grid_container_class).length?this.list_items_container.append(wc_ps_results_vars.grid_container):"grid"===wc_ps_results_vars.display_type&&this.list_items_container.find(wc_ps_results_vars.grid_container_class).show():this.list_items_container.find(wc_ps_results_vars.grid_container_class).hide()},routeSearchIn:function(){this.total_items=0,this.next_page_number=1,this.is_first_load=!0,this.endless_loading=!1,this.clearAll(),this.checkDisplayGrid(),this.getItems()},getItems:function(){this.cached[this.search_in+"-"+this.ps_lang+"-"+this.next_page_number]?(item_list=this.cached[this.search_in+"-"+this.ps_lang+"-"+this.next_page_number],this.addItems(item_list)):(this.is_first_load?this.ps_fetching_result_popup.fadeIn("fast"):this.ps_more_result_popup.fadeIn("fast"),a.get(b,{search_in:this.search_in,ps_lang:this.ps_lang,psp:this.next_page_number},function(a){this.addCache(this.search_in,this.ps_lang,this.next_page_number,a),this.addItems(a),this.is_first_load?this.ps_fetching_result_popup.fadeOut("normal"):this.ps_more_result_popup.fadeOut("normal"),0==a.total&&(this.is_first_load?this.ps_no_result_popup.fadeIn("normal").fadeOut(1e3):this.ps_no_more_result_popup.fadeIn("normal").fadeOut(1e3))}.bind(this)))},addItems:function(b){this.$(".ps_heading_search_in_name").html(b.search_in_name),0<b.total?(this.total_items+=b.items.length,a.each(b.items,function(a,b){"undefined"!=typeof b.card&&(b.card=b.card.replace(/<\!--.*?-->/g,"")),this.collection.add(b)}.bind(this)),b.total>b.items.length?(this.next_page_number++,this.render(),this.endless_loading=!1):(this.next_page_number=0,this.render()),this.compatibilityScript()):(this.next_page_number=0,this.render())},endlessScrollLoad:function(){if(!1==this.endless_loading){var b=a("#ps_more_check").offset().top+a("#ps_more_check").height()>=a(window).scrollTop(),c=a("#ps_more_check").offset().top<=a(window).scrollTop()+a(window).height();b&&c&&(this.endless_loading=!0,this.is_first_load=!1,this.getItems())}},compatibilityScript:function(){this.list_items_container.find(".animateMe").each(function(){var b=a(this),c=b.data("animation");b.addClass("animated").addClass(c)}),"function"==typeof this.list_items_container.masonry&&0<this.list_items_container.find(".masonry").length&&(1>this.list_items_container.find(wc_ps_results_vars.grid_container_class).length?setTimeout(function(){a("#ps_list_items_container").masonry(),a("#ps_list_items_container").masonry("reload")},500):setTimeout(function(){a("#ps_list_items_container").find(wc_ps_results_vars.grid_container_class).masonry(),a("#ps_list_items_container").find(wc_ps_results_vars.grid_container_class).masonry("reload")},500))}}),d.apps.App=Backbone.Router.extend({routes:{"?:query_parameters":"getResults_QueryString","keyword/:s_k/search-in/:s_in":"getResults","keyword/:s_k/search-in/:s_in/cat-in/:c_in":"getResults","keyword/:s_k/search-in/:s_in/search-other/:s_other":"getResults","keyword/:s_k/search-in/:s_in/cat-in/:c_in/search-other/:s_other":"getResults","keyword/:s_k/search-in/:s_in/search-other/:s_other/cat-in/:c_in":"getResults"},initialize:function(){this.collection=new d.collections.Items,this.resultCointainerView=new d.views.ResultContainer({collection:this.collection,el:a("#ps_results_container")}),Backbone.history&&Backbone.history.start({pushState:!0,root:wc_ps_results_vars.search_page_path}),Backbone.history.navigate(wc_ps_results_vars.default_navigate,{trigger:!0})},getResults:function(a,b){this.resultCointainerView.search_in=b,this.resultCointainerView.$(".ps_navigation").removeClass("ps_navigation_activated"),this.resultCointainerView.$(".ps_navigation"+b).addClass("ps_navigation_activated"),this.resultCointainerView.routeSearchIn()},getResults_QueryString:function(a){if(""==c){var b=this.parseQueryString(a);this.resultCointainerView.search_in=b.search_in,this.resultCointainerView.$(".ps_navigation").removeClass("ps_navigation_activated"),this.resultCointainerView.$(".ps_navigation"+b.search_in).addClass("ps_navigation_activated"),this.resultCointainerView.routeSearchIn()}},parseQueryString:function(a){var b={};return a&&_.each(_.map(decodeURI(a).split(/&/g),function(a){var b=a.split("="),c={};if(1<=b.length){var d;2==b.length&&(d=b[1]),c[b[0]]=d}return c}),function(a){_.extend(b,a)}),b}}),wc_ps_app.addInitializer(function(){new d.apps.App})})})(jQuery);